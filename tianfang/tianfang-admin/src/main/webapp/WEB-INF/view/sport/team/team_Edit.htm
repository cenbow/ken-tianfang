<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Form Elements - Ace Admin</title>
<meta name="description" content="Common form elements and layouts" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<#include "../../admin/head.htm"/>

		<link href="${base}/plugins/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
		<!-- <script type="text/javascript" src="${base}/plugins/uploadify/jquery-1.3.2.min.js"></script> -->
 		<script type="text/javascript" src="${base}/plugins/uploadify/swfobject.js"></script>
		<script type="text/javascript" src="${base}/plugins/uploadify/jquery.uploadify.v2.1.4.min.js"></script>		
</head>
<body>
	<div class="container-fluid" id="main-container">
		<div id="main-content" class="clearfix" style="margin-left: 0px;">
			<div id="page-content" class="clearfix">
				<div class="row-fluid">
					<!-- PAGE CONTENT BEGINS HERE -->
					<form id="submitForm" class="form-horizontal" method="POST" enctype="multipart/form-data" >
						<input type="hidden" name="id" value="${(result.id)!}" /> 
						<input type="hidden" name="gameIdStr" value="${(result.gameId)!}" /> 
						<input type="hidden" name="distructStr" value="${(result.distruct)!}" /> 
						<input type="hidden" name="provinceStr" value="${(result.province)!}" /> 
						<input type="hidden" name="teamTypeStr" value="${(result.teamType)!}" />
						<!-- <input type="hidden" name="lineup" value="" />  -->
						<input type="hidden" name="teamIntroduce" value="" />
						<input type="hidden" name="logo" value="" /> 
						<!-- 第一行 -->
						<div class="control-group">
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">球队名称</label> <input type="text" name="name"
									style="width: 280px;" class="span6" id="form-field-1"
									placeholder="球队名称" value="${(result.name)!}">
							</div>
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">联系方式</label> <input type="text" name="contact"
									style="width: 280px;" class="span6" id="form-field-1"
									placeholder="联系方式" value="${(result.contact)!}">
							</div>
						</div>						
						<!--  -->
						<div class="control-group">
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">成员人数</label>
									 <input type="text" name="members" style="width: 280px;" class="span6" id="form-field-1" placeholder="成员人数" value="${(result.members)!}">
							</div>
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">创建人</label> <input type="text" name="creater"
									style="width: 280px;" class="span6" id="form-field-1"
									placeholder="创建人" value="${(result.creater)!}">
							</div>
						</div>
						
						<!--  -->
						<div class="control-group">
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">主场</label> <input type="text" name="homeCourt"
									style="width: 280px;" class="span6" id="form-field-1"
									placeholder="主场" value="${(result.homeCourt)!}">
							</div>
							<div class="span6">   <!-- setUpTime -->
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">成立时间</label>
									 <!-- <input type="text" name="" style="width: 280px;" class="span6" id="form-field-1" placeholder="成立时间" value=""> -->
									 <input class="span6 date-picker" name="setUpTimeStr" id="createTimeE" type="text" data-date-format="yyyy-mm-dd" readonly="readonly"  placeholder="成立时间" value="${(result.setUpTimeStr)!}">
							</div>
						</div>
						
						<!--  -->
						<div class="control-group">
							<div class="span6">
								<label class="control-label" style="margin-right: 20px;"
									for="form-field-2">级别</label> <input type="text" name="grade"
									style="width: 280px;" class="span6" id="form-field-1"
									placeholder="级别" value="${(result.grade)!}">
							</div>
							<div class="span6">
								<label class="control-label" for="form-field-1"
									style="margin-right: 20px;">赛事类型</label> <select
									id="form-field-select-1" style="width: 260px;"
									name="gameId">
									<!-- <option value=" ">全部</option>
									<option value="1">国内青训队</option>
									<option value="2">国际青训队</option>  -->
								</select>
							</div>
						</div>
						<!-- -->
						<div class="control-group">
							<div class="span6">
								<label class="control-label" for="form-field-1" style="margin-right: 20px;">省份</label> 
									<select	id="form-field-select-Pro" style="width: 260px;" name="province" onchange="doDistrict();">
									<option value=" ">全部</option>
										<#if resultAddress?? >	
											<#list resultAddress as page>
												<option value="${(page.id)?replace(',','')}">${(page.name)!}</option>
											</#list>
										</#if>
								</select>
							</div>
							<div class="span6">
								<label class="control-label" for="form-field-1"
									style="margin-right: 20px;">区域</label> <select
									id="form-field-select-2" style="width: 260px;"
									name="distruct">
									<option value=" ">全部</option>
									<option value="普陀">普陀</option>
									<option value="杨浦">杨浦</option> 
								</select>
							</div>
							
						</div>
						<div class="control-group">
							<div class="span6">
								<label class="control-label" for="form-field-1"
									style="margin-right: 20px;">球队类型</label> <select
									id="form-field-select-3" style="width: 260px;"
									name="teamType">
									<option value=" ">全部</option>
									<option value="校队">校队</option>
									<option value="俱乐部">俱乐部</option> 
								</select>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="form-field-2">缩略图</label>
							<div class="controls">
								<input multiple type="file" id="id-input-file-3"/>
							</div>
							<div class="controls">
								<img id="img_show" alt="" src="${imgurl}${(result.logo)!}" style="width:60px;height:60px;"/>
							</div>									
						</div>
						
						<div class="control-group">
							<label class="control-label" for="form-field-2">阵型图</label>
							<div class="controls">
								<select class="js-position" name="lineup">
									<#if formationMap ??>
										<#list formationMap?keys as itemKey>
												<#if result.lineup ??>
													<#if result.lineup == itemKey>
														<option value="${(itemKey)!}" selected="selected">${(itemKey)!}</option>
													<#else>
														<option value="${(itemKey)!}">${(itemKey)!}</option>
													</#if>
												<#else>
													<option value="${(itemKey)!}">${(itemKey)!}</option>
												</#if>														
										</#list>
									</#if>
								</select>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label">球队介绍</label>
							<div class="controls">
								<script id="editor" type="text/plain" style="width:769px;height:300px;">${(result.teamIntroduce)!}</script>
							</div>
						</div>
						
						<div class="form-actions">
							<button id='savebutton' class="btn btn-info" type="button">
								<i class="icon-ok"></i>保存
							</button>
							&nbsp; &nbsp; &nbsp;
							<button id="reset" class="btn" type="reset">
								<i class="icon-undo"></i>关闭
							</button>
						</div>

					</form>
					<!-- PAGE CONTENT ENDS HERE -->
				</div>
				<!--/row-->
			</div>
			<!--/#page-content-->
		</div>
		<!-- #main-content -->
	</div>
	<!--/.fluid-container#main-container-->
	<a href="#" id="btn-scroll-up" class="btn btn-small btn-inverse"> <i
		class="icon-double-angle-up icon-only"></i>
	</a>
	<!-- basic scripts -->
	<!-- <script src="${base}/static/1.9.1/jquery.min.js"></script> -->
	<script type="text/javascript">
		window.jQuery || document.write("<script src='${base}/static/js/jquery-1.9.1.min.js'>\x3C/script>");
	</script>

	<script src="${base}/static/js/bootstrap.min.js"></script>
	<!-- page specific plugin scripts -->

	<script type="text/javascript"
		src="${base}/static/js/chosen.jquery.min.js"></script>
	<!-- 下拉框 -->

	<!--[if lt IE 9]>
		<script type="text/javascript" src="${base}/static/js/excanvas.min.js"></script>
		<![endif]-->
	<script type="text/javascript"
		src="${base}/static/js/jquery-ui-1.10.2.custom.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/jquery.ui.touch-punch.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/chosen.jquery.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/fuelux.spinner.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/bootstrap-datepicker.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/bootstrap-timepicker.min.js"></script>
	<script type="text/javascript" src="${base}/static/js/date.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/daterangepicker.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/bootstrap-colorpicker.min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/jquery.autosize-min.js"></script>
	<script type="text/javascript"
		src="${base}/static/js/jquery.inputlimiter.1.3.1.min.js"></script>
	<!-- ace scripts -->
	<script src="${base}/static/js/ace-elements.min.js"></script>
	<script src="${base}/static/js/ace.min.js"></script>
	<link
		href="${base}/plugins/umeditor1.2.2/themes/default/css/umeditor.css"
		type="text/css" rel="stylesheet">
	<script type="text/javascript" charset="utf-8"
		src="${base}/plugins/umeditor1.2.2/umeditor.config.js"></script>
	<script type="text/javascript" charset="utf-8"
		src="${base}/plugins/umeditor1.2.2/umeditor.min.js">
		
	</script>
	<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
	<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
	<script type="text/javascript" charset="utf-8"
		src="${base}/plugins/umeditor1.2.2/lang/zh-cn/zh-cn.js"></script>

	<!-- layer 弹出框处理 -->
	<script type="text/javascript" src="${base}/plugins/layer2.0/layer.js"></script>

	<script type="text/javascript">
	window.onload = function (){
		var province = $('[name=provinceStr]').val();
		var distruct = $('[name=distructStr]').val();
		if(province!=null&&province!=""){
			 document.getElementById('form-field-select-Pro').value=province;
		}else{
			document.getElementById('form-field-select-Pro').value="";
		}
		doDistrict();
	    if(distruct!=null&&distruct!=""){
			document.getElementById('form-field-select-2').value=distruct;
		}else{
			document.getElementById('form-field-select-2').value="";
		}
	}
	//省份 的区域加载 
	function doDistrict(){
		var id = $("#form-field-select-Pro option:selected").val();			
		var oSel = document.getElementById('form-field-select-2');
		var oOp = oSel.children;        //获取select列表的所有子元素。
		for(var i=0,len = oOp.length;i<len;i++)   
		{
			oSel.removeChild(oOp[0]);  
		}
		$.ajax({
			url:'${base}/team/byCreateriaAddress.do',
			data:{id:id},
			dataType: 'json',
			async:false,
			type:'post',
			success:function (data){
				console.log(data);
				var result = data.data;
				var area = document.getElementById("form-field-select-2");
				//请空下拉框的值 
				area.value ="";
				for (var i = 0; i < result.length; i++) {
					option =new Option(result[i].name,result[i].id);
					area.options.add(option);
				}					
				console.log("form-field-select-2--赋值完毕 ");
			}
		})
	}
	
	var um = UM.getEditor('editor');
		//赛事下拉框赋值 
		$.ajax({
			type : "POST",
			url : "${base}/game/getGameAll.do",
			datatype : "json",
			success : function(data){
				var gameId = document.getElementById("form-field-select-1");
				gameId[0] =new Option("全部",0);
				var gameName = $('[name=gameIdStr]').val();
				for(var o in data){
					if(data[o].title == undefined){
						continue;
					}
					option =new Option(data[o].title,data[o].id);
					gameId.options.add(option);
				}
				gameId.value = gameName;
			}
		})
		//区域信息 
		$.ajax({
			type : "POST",
			url : "${base}/addresses/getShInfo.do",
			datatype : "json",
			data : {"parendId":'310100'},
			success : function(data){
				console.log(data);
				var gameId = document.getElementById("form-field-select-2");
				gameId[0] =new Option("全部",0);
				var gameName = $('[name=distructStr]').val();
				var i=0;
				for(var o in data){
					if(data[o].name == undefined || data[o].name == '' || data[o].name == null ){
						continue;
					}
					i++;
					gameId[i] =new Option(data[o].name,data[o].id);
				}
				gameId.value = gameName;
			}
		})
		//类型 
		$.ajax({
			type : "POST",
			url : "${base}/teamType/getTeamTypeAll.do",
			datatype : "json",
			success : function(data){
				console.log(data);
				var gameId = document.getElementById("form-field-select-3");
				gameId[0] =new Option("全部",0);
				var gameName = $('[name=teamTypeStr]').val();
				var i=0;
				for(var o in data){
					if(data[o].typeName == undefined ||data[o].typeName == '' || data[o].typeName == null ){
						continue;
					}
					i++;
					gameId[i] =new Option(data[o].typeName,data[o].typeId);
				}
				gameId.value = gameName;
			}
		})

	   
		//日期框
		$('.date-picker').datepicker();	
	
		$(function() {

			$("#savebutton").on('click',function(){
				var content = UM.getEditor('editor').getContent();
				var micro_pic = $("#id-input-file-3").parent().find("img:first").css("background-image");
				$("#microPic").val(micro_pic);
				//$('[name=lineup]').val(urls);
				$('[name=teamIntroduce]').val(content);
				
				if( $('[name=name]').val() == null || $('[name=name]').val() == ""){
					layer.alert('球队名称不能为空~', { icon: 7 });
					return;
				} 
				
				if( $('[name=contact]').val() == null || $('[name=contact]').val() == ""){
					layer.alert('联系方式不能为空~', { icon: 7 });
					return;
				} 
				
				if( $('[name=members]').val() == null || $('[name=members]').val() == ""){
					layer.alert('球队人数不能为空~', { icon: 7 });
					return;
				} 
				
				if( $('[name=creater]').val() == null || $('[name=creater]').val() == ""){
					layer.alert('创建人不能为空~', { icon: 7 });
					return;
				}
				
				if( $('[name=homeCourt]').val() == null || $('[name=homeCourt]').val() == ""){
					layer.alert('主场信息不能为空~', { icon: 7 });
					return;
				}
				
				/* if( $('[name=setUpTimeStr]').val() == null || $('[name=setUpTimeStr]').val() == ""){
					layer.alert('成立时间不能为空~', { icon: 7 });
					return;
				} */
				
				if( $('[name=grade]').val() == null || $('[name=grade]').val() == ""){
					layer.alert('级别不能为空~', { icon: 7 });
					return;
				}
				
				var ajaxParams = $("#submitForm").serialize();
				$.ajax({
					type : "POST",
					url : "${base}/team/edit.do",
					data : ajaxParams,
					datatype : "json",// "xml", "html", "script", "json", "jsonp", "text".
					beforeSend : function() {
						$("#msg").html("logining");
					},
					success : function(data) {// 成功返回之后调用的函数
						var jsondata = data;// eval('(' + data + ')');
						if(data.success){
							parent.layer.msg('保存成功', {
								shade: [0.9, '#000'],
							    icon: 6,
							    time: 1500 //2秒关闭（如果不配置，默认是3秒）
							}, function(){
								parent.reload_page();
								var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
								parent.layer.close(index);
							}); 							
						}else{
							parent.layer.msg('保存出错', {
								shade: [0.9, '#000'],
							    icon: 6,
							    time: 1500 //2秒关闭（如果不配置，默认是3秒）
							}, function(){
							}); 	
						}
						//console.log(data.success);
					},
					complete : function(XMLHttpRequest, textStatus) {// 调用执行后调用的函数
						
					},
					error : function() {// 调用出错执行的函数
					}
				});
			});

			$('#id-input-file-1 , #id-input-file-2').ace_file_input({
				no_file : 'No File ...',
				btn_choose : 'Choose',
				btn_change : 'Change',
				droppable : false,
				onchange : null,
				thumbnail : false
			});
			
			var urls = '';
			var imgurl = '';
			$("#id-input-file-4").uploadify({
	            'uploader': '${base}/plugins/uploadify/uploadify.swf',
	            'script':"${base}/file/upload.htm;jsessionid=${sessionId!}",
	            'cancelImg': '${base}/plugins/uploadify/cancel.png',
	            'queueID': 'fileQueue',
	            'auto': true,
	            'multi':true,
	            'buttonText': 'select',
	            //'simUploadLimit' : 1,
	            //'queueSizeLimit' : 1,
	            'fileDesc' : 'pictures',
	            'sizeLimit':1024*1024*10,
	            'fileExt': '*.gif;*.png;*.jpg',
	            onComplete: function(event, queueID, fileObj, response, data) {
	                var dataObj = eval("("+response+")");
	                //console.log("event = " + event+ ";queueID = " + queueID + ";fileObj = " + fileObj+ ";dataObj = " + dataObj+ ";data = " + data);
					if(dataObj.status == 200){
						parent.layer.msg('图片上传成功', {
							shade: [0.9, '#000'],
						    icon: 6,
						    time: 800 //2秒关闭（如果不配置，默认是3秒）
						}, function(){
							//$("#img_show").attr("src",'${imgurl}'+dataObj.filePath);
							var img_id = "img_show_" + queueID;
							img_url = '${imgurl}'+dataObj.filePath;
							imgurl = dataObj.filePath + ",";
							$("#img_contain").append("<img id='" + img_id + "' alt='' src='" + img_url + "' style='width:60px;height:60px;'/>");
							urls += imgurl; 
							console.log(urls);
						});                
	                //console.log(dataObj.filePath);
					//$("#thumbnail").val(dataObj.filePath);
	                //$("#pic").val(urls);
					}else{
						layer.msg("文件:" + fileObj.name + "上传失败");
					}
	                
	            },
	            onSelect:function(){
	            },
	            onError: function(event, queueID, fileObj) {
	                layer.msg("文件:" + fileObj.name + "上传失败");
	            }
	        });
			
			
		// chkItem事件
		function bindCheck() {
			var $chk = $("[name = checkBoxId]:checkbox");
			$chk.on("click", function() {
				$("#check-all").attr("checked",
						$chk.length == $chk.filter(":checked").length);
			})
		}

		// 删除场地
		$("#deletes").on("click",function() {
					var $chk = $("[name = checkBoxId]:checkbox").filter(
							":checked");
					var count = $chk.length;
					if (count > 0) {
						//信息框-例2
						layer.confirm('你确定删除场地吗？', {
							icon : 3
						}, function(index) {
							layer.close(index);
							$chk.each(function() {
								var tr = $(this).parent().parent().parent();
								tr.remove();
							});
							$chk = $("[name = checkBoxId]:checkbox").filter(
									":checked");
							if ($chk.length == 0) {
								$("#check-all").attr("checked", false);
							}
						});
					}
				});
		
		$("#id-input-file").uploadify({
            'uploader': '${base}/plugins/uploadify/uploadify.swf',
            'script':"${base}/file/upload.htm;jsessionid=${sessionId!}",
            'cancelImg': '${base}/plugins/uploadify/cancel.png',
            'queueID': 'fileQueue',
            'auto': true,
            'buttonText': 'select',
            'sizeLimit':1024*1024*10,
            'simUploadLimit' : 1,
            'queueSizeLimit' : 1,
            'fileDesc' : 'video',
            'fileExt': '*.flv',//格式*.gif,*.png
            onComplete: function(event, queueID, fileObj, response, data) {
                var dataObj = eval("("+response+")");
                if(dataObj.status == 200){
                	console.log(dataObj.filePath);
    				$("#newVideo").val(dataObj.filePath);
                }else{
                	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的flv格式的视频文件", {
        				shade: [0.9, '#000'],
        			    icon: 3,
        			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
        			}); 
                }
            },
            onSelect:function(){
            },
            onError: function(event, queueID, fileObj) {
            	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的flv格式的视频文件", {
    				shade: [0.9, '#000'],
    			    icon: 3,
    			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
    			}); 
            }
        });
		
		$("#id-input-file-3").uploadify({
            'uploader': '${base}/plugins/uploadify/uploadify.swf',
            'script':"${base}/file/upload.htm;jsessionid=${sessionId!}",
            'cancelImg': '${base}/plugins/uploadify/cancel.png',
            'queueID': 'fileQueue',
            'auto': true,
            //'multi':true,
            'buttonText': 'select',
            'sizeLimit':1024*1024*10,
            'simUploadLimit' : 1,
            'queueSizeLimit' : 1,
            'fileDesc' : 'pictures',
            'sizeLimit':1024*1024*10,
            'fileExt': '*.gif;*.png;*.jpg',
            onComplete: function(event, queueID, fileObj, response, data) {
                var dataObj = eval("("+response+")");
                if(dataObj.status == 200){
                	parent.layer.msg('图片上传成功', {
						shade: [0.9, '#000'],
					    icon: 6,
					    time: 800 //2秒关闭（如果不配置，默认是3秒）
					}, function(){
						$("#img_show").attr("src",'${imgurl}'+dataObj.filePath);
					});                
                	//console.log(dataObj.filePath);
					$("[name=logo]").val(dataObj.filePath);
                }else{
                	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的图片", {
        				shade: [0.9, '#000'],
        			    icon: 3,
        			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
        			}); 
                }
            },
            onSelect:function(){
            },
            onError: function(event, queueID, fileObj) {
            	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的图片", {
    				shade: [0.9, '#000'],
    			    icon: 3,
    			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
    			}); 
            }
        });	
		
		//复选框 
		$("#check-all").on("click", function() {
			if ($(this).prop('checked')) {
				$("[name = checkBoxId]:checkbox").prop("checked", true);
			} else {
				$("[name = checkBoxId]:checkbox").prop("checked", false);
			}
		});
		
		$('#reset').click(function(){
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		});
		
		});
	</script>
</body>
</html>
