<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tianfang.train.mapper.XTrainingCourseMapper" >
  <resultMap id="BaseResultMap" type="com.tianfang.train.dto.TrainingCourseDtoX" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Sep 02 10:44:01 CST 2015.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="course_time" property="courseTime" jdbcType="INTEGER" />
    <result column="tag_id" property="tagId" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="start_time" property="startTime" jdbcType="BIGINT" />
    <result column="end_time" property="endTime" jdbcType="BIGINT" />
    <result column="max_student" property="maxStudent" jdbcType="INTEGER" />
    <result column="actual_student" property="actualStudent" jdbcType="INTEGER" />
    <result column="isneed_cname" property="isneedCname" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="BIGINT" />
    <result column="last_update_time" property="lastUpdateTime" jdbcType="BIGINT" />
  </resultMap>
  
  <!-- 查询可报名课程列表：ava=1表示只查询尚未报满的课程，ava=0表示查询所有课程 -->
  <select id="getACourseLst" resultType="com.tianfang.train.dto.TrainingCourseDtoX">
  	SELECT 
  	id, name, course_time courseTime, 
      tag_id tagId, type, start_time startTime, 
      end_time endTime, max_student maxStudent, actual_student actualStudent, 
      isneed_cname isneedCname, status, create_time createTime, 
      last_update_time lastUpdateTime,description,equip,pic,is_opened isOpened,micro_pic microPic  
  	
  	 FROM training_course
  	<where>
  		`status`=1 AND is_opened=1
  		<if test="ava==1">
  			AND actual_student<![CDATA[<]]>max_student
  		</if>
		<if test="ava==0"></if>
		<if test="marked==1">
			AND marked=${marked}		    
		</if>
  	</where>
  </select>
  
  <!-- 通过Id查询课程信息 -->
  <select id="getCourseById" resultType="com.tianfang.train.dto.TrainingCourseDtoX">
	SELECT 
  	id, name, course_time courseTime, 
      tag_id tagId, type, start_time startTime, description,
      end_time endTime, max_student maxStudent, actual_student actualStudent, 
      isneed_cname isneedCname, status, create_time createTime, 
      last_update_time lastUpdateTime, is_opened isOpened
       FROM training_course
	<where>
		id=${id}
	</where> 
  </select>
  
   <!-- 通过Id查询课程信息 -->
  <select id="getCourse" resultType="com.tianfang.train.dto.TrainingCourseDtoX">
	SELECT 
  	a.id id , a.name name, a.course_time courseTime, 
      a.tag_id tagId, a.type type, a.start_time startTime, a.description description,
      a.end_time endTime, b.max_student maxStudent, a.actual_student actualStudent, 
      a.isneed_cname isneedCname, a.status status, a.create_time createTime, 
      a.last_update_time lastUpdateTime,a.is_opened isOpened 
      FROM
	  training_course a
	   INNER JOIN training_course_class b ON a.id = b.course_id
	<where>
		b.id=${id} and b.course_id=${courseId} and a.status=1 and b.status=1
	</where> 
  </select>
  
  <!--  -->
  <select id="findUserCourceBy" resultType="com.tianfang.train.dto.TrainingCourseDtoX">
	SELECT a.isneed_cname as isneedCname FROM `training_course`  a WHERE a.`id` = (
		SELECT DISTINCT b.`course_id` FROM `training_course_class` b WHERE b.`id` = #{classId}
	);
  </select>
  
  
</mapper>