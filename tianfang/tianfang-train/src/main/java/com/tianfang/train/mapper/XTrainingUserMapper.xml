<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tianfang.train.mapper.XTrainingUserMapper">
	<resultMap id="BaseResultMap" type="com.tianfang.train.pojo.TrainingUser">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Sep 02 
			10:44:01 CST 2015. -->
	    <id column="id" property="id" jdbcType="VARCHAR" />
	    <result column="open_id" property="openId" jdbcType="VARCHAR" />
	    <result column="pname" property="pname" jdbcType="VARCHAR" />
	    <result column="utype" property="utype" jdbcType="INTEGER" />
	    <result column="cname" property="cname" jdbcType="VARCHAR" />
	    <result column="location" property="location" jdbcType="VARCHAR" />
	    <result column="birthday" property="birthday" jdbcType="BIGINT" />
	    <result column="origin_school" property="originSchool" jdbcType="VARCHAR" />
	    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
	    <result column="position" property="position" jdbcType="VARCHAR" />
	    <result column="pic" property="pic" jdbcType="VARCHAR" />
	    <result column="micro_pic" property="microPic" jdbcType="VARCHAR" />
	    <result column="description" property="description" jdbcType="VARCHAR" />
	    <result column="create_time" property="createTime" jdbcType="BIGINT" />
	    <result column="update_time" property="updateTime" jdbcType="BIGINT" />
	    <result column="space_name" property="spaceName" jdbcType="VARCHAR" />
	    <result column="course_name" property="courseName" jdbcType="VARCHAR" />
	    <result column="last_login_time" property="lastLoginTime" jdbcType="BIGINT" />
	    <result column="status" property="status" jdbcType="INTEGER" />
	</resultMap>
	
	<insert id="applyCourse" parameterType="com.tianfang.train.pojo.TrainingUser"
		useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Sep 02 
			10:44:01 CST 2015. -->
		insert into training_user (id, open_id, pname,
		utype, cname, birthday,
		origin_school, mobile, status,
		create_time, update_time)
		values (#{id,jdbcType=VARCHAR}, #{openId,jdbcType=VARCHAR},
		#{pname,jdbcType=VARCHAR},
		#{utype,jdbcType=INTEGER}, #{cname,jdbcType=VARCHAR}, #{birthday,jdbcType=BIGINT},
		#{originSchool,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR},
		#{status,jdbcType=INTEGER},
		#{createTime,jdbcType=BIGINT}, #{updateTime,jdbcType=BIGINT})
	</insert>

	<update id="updateOrder" parameterType="com.tianfang.train.pojo.TrainingUser">
		UPDATE training_user_course SET
		deposit_ispayed=${state},trade_no=#{tradeNo}
		<where>
			order_no=#{orderNo}
		</where>
	</update>

	<!-- 根据openId查询微信用户信息 -->
	<select id="getWXLogin" resultType="com.tianfang.train.dto.TrainingUserDto">
		SELECT id, open_id openId, pname,
		utype, cname, birthday,pic,
		origin_school originSchool, mobile, status,
		create_time createTime, update_time updateTime , last_login_time lastLoginTime FROM training_user WHERE
		open_id=#{openId};
	</select>

	<!-- 新增用户信息 -->
	<insert id="addUser" parameterType="com.tianfang.train.pojo.TrainingUser">
		insert into training_user (id, open_id, pname,
		utype, cname, birthday,
		origin_school, mobile, status,
		create_time, update_time,last_login_time)
		values (#{id,jdbcType=VARCHAR}, #{openId,jdbcType=VARCHAR},
		#{pname,jdbcType=VARCHAR},
		#{utype,jdbcType=INTEGER}, #{cname,jdbcType=VARCHAR}, #{birthday,jdbcType=BIGINT},
		#{originSchool,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR},
		#{status,jdbcType=INTEGER},
		#{createTime,jdbcType=BIGINT}, #{updateTime,jdbcType=BIGINT},#{lastLoginTime,jdbcType=BIGINT})
	</insert>

	<delete id="deleteUser" parameterType="com.tianfang.train.pojo.TrainingUser">
		update training_user set status=0,update_time=#{updateTime} WHERE
		id=#{id,jdbcType=VARCHAR}
	</delete>

	<update id="updateUser" parameterType="com.tianfang.train.pojo.TrainingUser">
		update training_user set
		update_time=#{updateTime},pname=#{pname},mobile=#{mobile},location=#{location},cname=#{cname},birthday=#{birthday},
		origin_school=#{originSchool},position=#{position},pic=#{pic},description=#{description},micro_pic=#{microPic} WHERE id=#{id,jdbcType=VARCHAR}
	</update>
  	
	<!-- 根据id更新用户登录时间 -->
	<update id="updateLoginTime" parameterType="com.tianfang.train.pojo.TrainingUser">
		UPDATE training_user SET last_login_time=${loginTime} WHERE id=#{id}
	</update>
  <!-- 根据openID查询用户信息 -->
  <select id="getUIByOpenID" resultType="com.tianfang.train.dto.TrainingUserDto">
      SELECT id,pname,cname,location,birthday,origin_school AS originSchool, mobile , position ,pic, description,create_time as createTime, update_time as updateTime ,`status`,last_login_time AS lastLoginTime,micro_pic as microPic FROM training_user  WHERE open_id=#{openID} AND `status`=1
  </select>
</mapper>