<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tianfang.train.mapper.TrainingCourseExMapper">
	<select id="selectCourseInfo" resultType="com.tianfang.train.dto.TrainingCourseDtoX">
		SELECT
		c.id,
		c.name,
		c.course_time AS courseTime,
		c.description,
		c.start_time AS startTime,
		c.end_time AS endTime,
		c.max_student AS
		maxStudent,
		c.marked AS marked,
		c.is_opened AS isOpened,
		ct.tag_name AS tagName
		FROM
		training_course c
		INNER JOIN
		training_course_tag ct ON c.tag_id = ct.id
		WHERE 1=1
		<include refid="where_course_1" />
		and c.status = 1
		<!-- and cc.status = 1 -->
		limit #{page.startNum}, #{page.pageSize}
	</select>
	<select id="count" resultType="java.lang.Long">
		SELECT
		COUNT(*)
		FROM
		training_course c
		WHERE 1=1
		<include refid="where_course_1" />
		and c.status = 1
		<!-- and cc.status = 1 -->
	</select>
	<insert id="save" parameterType="com.tianfang.train.pojo.TrainingCourse"
		useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Sep 02 
			17:34:13 CST 2015. -->
		  insert into training_course (id, name, course_time, 
	      tag_id, address, type, 
	      equip, description, start_time, 
	      end_time, max_student, actual_student, 
	      isneed_cname, marked, pic, 
	      video, micro_pic, create_time, 
	      last_update_time, status, is_opened
	      )
	    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{courseTime,jdbcType=INTEGER}, 
	      #{tagId,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, #{type,jdbcType=INTEGER}, 
	      #{equip,jdbcType=VARCHAR}, #{description,jdbcType=VARCHAR}, #{startTime,jdbcType=BIGINT}, 
	      #{endTime,jdbcType=BIGINT}, #{maxStudent,jdbcType=INTEGER}, #{actualStudent,jdbcType=INTEGER}, 
	      #{isneedCname,jdbcType=INTEGER}, #{marked,jdbcType=TINYINT}, #{pic,jdbcType=VARCHAR}, 
	      #{video,jdbcType=VARCHAR}, #{microPic,jdbcType=VARCHAR}, #{createTime,jdbcType=BIGINT}, 
	      #{lastUpdateTime,jdbcType=BIGINT}, #{status,jdbcType=INTEGER}, #{isOpened,jdbcType=INTEGER}
	      )
	</insert>
	<sql id="where_course_1">
		<if test="trainingCourseDto.name != null and trainingCourseDto.name !='' ">
			and c.name like "%"#{trainingCourseDto.name}"%"
		</if>
		<if
			test="trainingCourseDto.courseTime != null and trainingCourseDto.courseTime !=''">
			and c.course_time like #{trainingCourseDto.courseTime}
		</if>
		<if test="trainingCourseDto.tagId != null">
			and c.tag_id = #{trainingCourseDto.tagId}
		</if>
		<!-- <if -->
		<!-- test="trainingCourseDto.address != null and trainingCourseDto.address 
			!='' "> -->
		<!-- and a.place like "%"#{trainingCourseDto.address}"%" -->
		<!-- </if> -->
	</sql>
	<!-- 报名人数记录actual_student加1 -->
	<update id="addOneActualStudent" parameterType="java.lang.Integer">
		update
		training_course set actual_student=actual_student+1,last_update_time
		=
		unix_timestamp(now()) where id=#{id}
	</update>

	<update id="updateByTrainingCourse" parameterType="com.tianfang.train.pojo.TrainingCourse">
		<!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 28 15:23:54 CST 2015.
    -->
	    update training_course
	    <set >
	      <if test="name != null" >
	        name = #{name,jdbcType=VARCHAR},
	      </if>
	      <if test="courseTime != null" >
	        course_time = #{courseTime,jdbcType=INTEGER},
	      </if>
	      <if test="tagId != null" >
	        tag_id = #{tagId,jdbcType=VARCHAR},
	      </if>
	      <if test="address != null" >
	        address = #{address,jdbcType=VARCHAR},
	      </if>
	      <if test="type != null" >
	        type = #{type,jdbcType=INTEGER},
	      </if>
	      <if test="equip != null" >
	        equip = #{equip,jdbcType=VARCHAR},
	      </if>
	      <if test="description != null" >
	        description = #{description,jdbcType=VARCHAR},
	      </if>
	      <if test="startTime != null" >
	        start_time = #{startTime,jdbcType=BIGINT},
	      </if>
	      <if test="endTime != null" >
	        end_time = #{endTime,jdbcType=BIGINT},
	      </if>
	      <if test="maxStudent != null" >
	        max_student = #{maxStudent,jdbcType=INTEGER},
	      </if>
	      <if test="actualStudent != null" >
	        actual_student = #{actualStudent,jdbcType=INTEGER},
	      </if>
	      <if test="isneedCname != null" >
	        isneed_cname = #{isneedCname,jdbcType=INTEGER},
	      </if>
	      <if test="marked != null" >
	        marked = #{marked,jdbcType=TINYINT},
	      </if>
	      <if test="pic != null" >
	        pic = #{pic,jdbcType=VARCHAR},
	      </if>
	      <if test="video != null" >
	        video = #{video,jdbcType=VARCHAR},
	      </if>
	      <if test="microPic != null" >
	        micro_pic = #{microPic,jdbcType=VARCHAR},
	      </if>
	      <if test="createTime != null" >
	        create_time = #{createTime,jdbcType=BIGINT},
	      </if>
	      <if test="lastUpdateTime != null" >
	        last_update_time = #{lastUpdateTime,jdbcType=BIGINT},
	      </if>
	      <if test="status != null" >
	        status = #{status,jdbcType=INTEGER},
	      </if>
	      <if test="isOpened != null" >
	        is_opened = #{isOpened,jdbcType=INTEGER},
	      </if>
	    </set>
	    where id = #{id,jdbcType=VARCHAR}
	</update>

</mapper>